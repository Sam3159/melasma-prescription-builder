<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
"use strict";

/* Supabase config */
const SUPABASE_URL = "https://ogzruhymglenzwizmggd.supabase.co";
const SUPABASE_KEY = "sb_publishable_VudO6SBFp9kzL2YIkSeTQA_dP8jdGHC";

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

/* Helpers */
function el(id) {
  return document.getElementById(id);
}
function show(id, on) {
  const e = el(id);
  if (!e) return;
  e.classList.toggle("hidden", !on);
}

let authIntent = "prescriber";

/* Auth */
async function signIn() {
  const email = el("loginEmail").value.trim();
  const password = el("loginPassword").value.trim();
  const err = el("loginError");

  err.style.display = "none";
  err.textContent = "";

  const res = await sb.auth.signInWithPassword({ email, password });
  if (res.error) {
    err.textContent = res.error.message;
    err.style.display = "block";
    return;
  }

  afterLogin();
}

async function afterLogin() {
  show("loginOverlay", false);
  show("landing", false);
  show("app", true);
}

/* Wire buttons safely */
document.addEventListener("DOMContentLoaded", function () {

  const prescriberBtn = el("goPrescriber");
  if (prescriberBtn) {
    prescriberBtn.addEventListener("click", function () {
      authIntent = "prescriber";
      el("loginTitle").textContent = "Prescriber Login";
      el("loginSubtitle").textContent = "Sign in to continue";
      show("landing", false);
      show("loginOverlay", true);
    });
  }

  const adminBtn = el("goAdmin");
  if (adminBtn) {
    adminBtn.addEventListener("click", function () {
      authIntent = "admin";
      el("loginTitle").textContent = "Admin Login";
      el("loginSubtitle").textContent = "Sign in to continue";
      show("landing", false);
      show("loginOverlay", true);
    });
  }

  const loginBtn = el("loginSignIn");
  if (loginBtn) {
    loginBtn.addEventListener("click", signIn);
  }

  const backBtn = el("loginBack");
  if (backBtn) {
    backBtn.addEventListener("click", function () {
      show("loginOverlay", false);
      show("landing", true);
    });
  }
});
</script>

</script>
